<pre id=Z><script>
B=[y=x=t=r=S=0];

setInterval(onkeyup=e=>{
u=[x,y,r];
e?(g=e.which-38)?g-2?x-=g:y++:r++:y++;
z=S;
C=[...B,S=h=0];
for(i=8;i--;i>3?a<0|a>9|(h|=b<0|B[b]>>a&1)?[x,y,r]=u:0:C[b]|=1<<a){

a='456768696009181'[i%4+(i&2)*t];
b=a&3;a>>=2;
for(j=r+=4;j--;a=f)f=b,b=2+!t-(t>5)-a;
a+=x+4;b+=20-y
}

e||h&&(x=y=0,t=r%7,B=C);
for(i=19+z;i--;)for(j=B[i]==1023?++S-S:11;j--;)
Z.innerText=z+=`.X
`[j>9?2:C[i]>>j&1]+' '

},200)

</script>
