<pre id=Z><script>
B=[y=x=t=r=S=0];

setInterval(onkeyup=e=>{
u=[x,y,r];
e?(g=e.which-38)?g-2?x-=g:y++:r++:y++;
C=[...B,h=0];
for(i=8;i--;i>3?(h|=a<0|a>10|b<0|B[b]>>a&1)?[x,y,r]=u:0:C[b]|=1<<a){

v='4567686960091810'[i%4+(i&2)*t];
for(j=r+=4;j--;)v=v/4|(2+!t-(t>5)-v%4)*4;a=v/4+x+4;b=v%4+20-y
}

B=h&!e?C.filter(_=>_-1023?_:++S-S,x=y=0,t=(t+1)%7):B;

z=S;for(i=209;i;)Z.innerText=z+=' '+`.O
`[i--%11?C[i/11|0]>>i%11&1:2]},200)

</script>
